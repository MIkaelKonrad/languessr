<!DOCTYPE html>

<html>
	<head>
		<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
		<title>
			Summary
		</title>

		<!-- Importing FirstButton.css for button style and Summary.css for the style of point Bar. -->
		<link rel="stylesheet" type="text/css"  href="/static/css/FirstButton.css">
        <link rel="stylesheet" type="text/css"  href="/static/css/Summary.css">
		
	</head>
	<body>
        <!-- Note: A map summerizing all guesses should be added between the box on top and the score bar at the bottom.-->
		<!-- the div element below creates the box on top of the page. -->
		<div class="summary-container">
			<div class="summary-center">
				<h2> You have completed A full game. Start a new one</h2>
				<a href="\Start">
					<button class=big-button>
						Return to Start
					</button>
				</a>
			</div>
		</div>

        <!-- Defining div element for map -->
        <div id="map"></div>

        <!-- the div element below creates the point bar and the text above it.-->
        <div class="total-score">
            <h2 id ="totalSc"> </h2>
        </div>
        <div class="pointBar-container"> 
            <div class="point-Bar " id="pointBar"> </div>
        </div>

        <!-- the two script elements adjust the div elements above to the score achived by the user.-->
        <script> 
            window.onload = function() {
                var fillpercent = Math.round(parseFloat(localStorage.getItem('totalScore'))/250);
                document.getElementById('pointBar').style.width= fillpercent.toString() + "%";
                document.getElementById('pointBar').innerText = localStorage.getItem('totalScore').toString() +'/25000';
            }
        </script>
		<script> 
			localStorage.setItem('roundNumber',1);
            document.getElementById('totalSc').innerText = 'Your total score was ' + localStorage.getItem('totalScore').toString()
                 +' and you were off by a total of ' + localStorage.getItem('totalDistance') + ' km.';
		</script>


        <!-- Js code for the Map displaying a summary of guesses. -->
        <script>
            var array= localStorage.getItem('guessInfo').split(',');
            let map;
            /* The while loop below is to compute max and min lat (resp. lng) of both guesses and solutions.
             this is later used to determine the center of the map */
            var latMax = parseFloat(array[1]);
            var latMin = parseFloat(array[1]);
            var lngMax = parseFloat(array[2]);
            var lngMin = parseFloat(array[2]);
            var j = 1;
            while (j<10){
                if (parseFloat(array[2*j+1])> latMax){
                    latMax = parseFloat(array[2*j+1]);
                }else if(parseFloat(array[2*j+1])< latMin){
                    latMin = parseFloat(array[2*j+1]);
                }
                if(parseFloat(array[2*j+2])> lngMax){
                    lngMax = parseFloat(array[2*j+2]);
                }else if(parseFloat(array[2*j+2])< lngMin){
                    lngMin = parseFloat(array[2*j+2]);
                }
                j= j+1;
            };
            
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: (latMax + latMin)/2, lng: (lngMax + lngMin)/2 },
                    zoom: 4
                });
                /* The while loop below cycles through all of the 5 guesses made by the user. */
                var i = 0;
                while(i<5){
                    /* Below we build a line connecting the i+1 th guess with the i+1 th solution, 
                        using the Polyline class from the google maps API*/
                    var connectingLine = new google.maps.Polyline({
                        path: [ {lat: parseFloat(array[i*4 + 1]) , lng: parseFloat(array[i*4 + 2])},
                                     {lat: parseFloat(array[i*4 + 3]) , lng: parseFloat(array[i*4 + 4])} ],
                        geodesic: true,
                        strokeColor: "#000000",
                        strokeOpacity: 1.0,
                        strokeWeight: 1.5,
                    });
                    connectingLine.setMap(map);
                    /* guessIcon and solIcon are objects, which can be used as Icons for the markers */ 
                    const guessIcon = {
                        url: '/static/images/GuessIcon'+(i+1) +'.png', // url
                        scaledSize: new google.maps.Size(30, 30), // scaled size
                        origin: new google.maps.Point(0,0), // origin
                        anchor: new google.maps.Point(15, 15) // anchor
                    };
                    const solIcon = {
                        url: '/static/images/solIcon'+(i+1) +'.png', // url
                        scaledSize: new google.maps.Size(30, 30), // scaled size
                        origin: new google.maps.Point(0,0), // origin
                        anchor: new google.maps.Point(15, 15) // anchor
                    };
                    /* Markers for i+1 th guess (resp. sol) as instance of Marker class from the googlemaps API */
                    var markerGuess = new google.maps.Marker({
                        map: map,
                        position: {lat: parseFloat(array[i*4 + 1]) , lng: parseFloat(array[i*4 + 2])},
                        draggable: false,
                        icon: guessIcon
                    });
                    var markerSol = new google.maps.Marker({
                        map: map,
                        position: {lat: parseFloat(array[i*4 + 3]) , lng: parseFloat(array[i*4 + 4])},
                        draggable: false,
                        icon: solIcon
                    });
                    i=i+1;
                }
            }
        </script>

        <!-- The Js Code below accesses the GoogleMaps API-->
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAx9c3TZDsF8PKs6jC5lf1ZlG-MN8iHthE&callback=initMap">
        </script>
        
	</body>
	
	
</html>